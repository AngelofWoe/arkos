#!/bin/bash

# Main
main () {
    . /home/ark/.config/arkos.cfg

    clear > /dev/tty1

    cp /home/ark/.asoundrcbak /home/ark/.asoundrc
    if [[ "${launchimage}" == "jpg" ]]; then # Run loading.jpg
        if [ -f "/roms/launchimages/loading.jpg" ]; then
            image-viewer /roms/launchimages/loading.jpg &
            PROC="${!}"
            (sleep 1.5s; kill "${PROC}")
        fi
    elif [[ "${lauchimage}" == "ascii" ]]; then # Run loading.ascii
        printf "\033c" >> /dev/tty1
        if [ -f "/roms/launchimages/loading.ascii" ]; then
            echo -en "\033[21m" > /dev/tty1 && cat /roms/launchimages/loading.ascii > /dev/tty1
        fi
    fi
    echo simple_ondemand | sudo tee /sys/devices/platform/ff400000.gpu/devfreq/ff400000.gpu/governor > /dev/null
    echo interactive | sudo tee /sys/devices/system/cpu/cpufreq/policy0/scaling_governor > /dev/null
    echo dmc_ondemand | sudo tee /sys/devices/platform/dmc/devfreq/dmc/governor > /dev/null
}

# Make sure script is running directly
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi
