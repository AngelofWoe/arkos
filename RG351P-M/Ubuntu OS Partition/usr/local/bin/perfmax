#!/bin/bash

# Main
main () {
    clear > /dev/tty1
    rm /home/ark/.asoundrc

    . /home/ark/.config/arkos.cfg

    if [[ "${launchimage}" == "jpg" ]]; then
        if [ -f "/roms/launchimages/loading.jpg" ]; then
            image-viewer /roms/launchimages/loading.jpg &
            PROC="${!}"
            (sleep 1.5s; kill "${PROC}")
        fi
    elif [[ "${launchimage}" == "ascii" ]]; then
        printf "\033c" >> /dev/tty1
        if [ -f "/roms/launchimages/loading.ascii" ]; then
            echo -en "\033[21m" > /dev/tty1 && cat /roms/launchimages/loading.ascii > /dev/tty1
        fi
    fi
    if [[ "${1}" == "On" ]] || [[ "${1}" == "standalone-Rice" ]] || [[ "${1}" == "standalone-Glide64mk2" ]] || [[ "${1}" == "retrorun" ]] || [[ "${1}" == "retrorun32" ]] || [[ "${2}" == "flycast" ]] || [[ "${2}" == "flycast32_rumble" ]] || [[ "${2}" == "flycast_xtreme" ]] || [[ "${2}" == "reicast_xtreme" ]] || [[ "${1}" == "standalone" ]] || [[ "${1}" == "standalone-go" ]] || [[ "${2}" == "yabasanshiro" ]] || [[ "${2}" == "yabause" ]] || [[ "${2}" == "mupen64plus" ]] || [[ "${2}" == "parallel_n64" ]] || [[ "${2}" == "mupen64plus_next" ]] || [[ "${2}" == "pcsx_rearmed_rumble" ]] || [[ "${2}" == "pcsx_rearmed" ]] || [[ "${2}" == "duckstation" ]]; then
        echo performance | sudo tee /sys/devices/platform/ff400000.gpu/devfreq/ff400000.gpu/governor > /dev/null
        echo performance | sudo tee /sys/devices/system/cpu/cpufreq/policy0/scaling_governor > /dev/null
        echo performance | sudo tee /sys/devices/platform/dmc/devfreq/dmc/governor > /dev/null
    else
        echo simple_ondemand | sudo tee /sys/devices/platform/ff400000.gpu/devfreq/ff400000.gpu/governor > /dev/null
        echo interactive | sudo tee /sys/devices/system/cpu/cpufreq/policy0/scaling_governor > /dev/null
        echo dmc_ondemand | sudo tee /sys/devices/platform/dmc/devfreq/dmc/governor > /dev/null
    fi
}

# Make sure script is running directly
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi
